<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.svg">
</head>

<!-- Firebase -->
<script src="firebase-config.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  firebase.initializeApp(window.FIREBASE_CONFIG);
  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

<body class="dashboard">
<div class="container">

  <a class="logo" href="dashboard.html">ðŸ“š</a>
  <div class="hero card">
    <h2>ðŸ‘‹ Welcome to the Library!</h2>
    <p class="muted">View your account details</p>
  </div>

  <!-- USER INFO -->
  <div class="card center-actions">
    <h3>Your Student ID</h3>
    <p id="studentId" class="muted">Loading...</p>
  </div>

  <!-- ACTIONS -->
  <div class="card center-actions">
    <button class="dash-btn secondary" onclick="goDashboard()">â¬… Back</button>
    <button class="dash-btn back" onclick="logout()">ðŸšª Logout</button>
  </div>

</div>

<script>
function goDashboard() {
  window.location.href = "dashboard.html";
}

function logout() {
  auth.signOut().then(() => {
    window.location.href = "index.html";
  });
}

auth.onAuthStateChanged(async (user) => {
  if (!user) {
    window.location.href = "index.html";
    return;
  }

  try {
    const doc = await db.collection("users").doc(user.uid).get();

    if (doc.exists && doc.data().sid) {
      document.getElementById("studentId").innerHTML =
        `<b>${doc.data().sid}</b>`;
    } else {
      document.getElementById("studentId").innerHTML =
        "<span style='color:#b91c1c'>Profile incomplete</span>";
    }
  } catch (err) {
    document.getElementById("studentId").innerText = "Error loading profile";
  }
});
</script>

</body>
</html>